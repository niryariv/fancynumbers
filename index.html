<!DOCTYPE HTML>
<html>
<head>
  <!-- Change this if you want to allow scaling -->
  <meta name="viewport" content="width=default-width; user-scalable=no" />

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">

  <title>Odd Color</title>
  <link rel="stylesheet" href="master.css" type="text/css" />		
  <link rel="stylesheet" href="mindset.css" type="text/css" />		

  <!-- iPad/iPhone specific css below, add after your main css >
  <link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
  -->
  <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
  <script type="text/javascript" charset="utf-8" src="zepto.js"></script>
  <script type="text/javascript" charset="utf-8">


  // If you want to prevent dragging, uncomment this section
  /*
  function preventBehavior(e) 
  { 
  e.preventDefault(); 
  };
  document.addEventListener("touchmove", preventBehavior, false);
  */

  function onBodyLoad()
  {
    document.addEventListener("deviceready",onDeviceReady,false);
  }

  /* When this function is called, PhoneGap has been initialized and is ready to roll */
  function onDeviceReady()
  {
  }

  var score = 0;
  var current = -1;
  
  var colors = ['#6566ff', '#00ccff', '#33cd34', '#f8f701', '#fd6601', '#fe0002','#960298', '#960300'];
  var userColor = 0;
  var isPrefs = false;
  
  var totalCards = 0;
  var totalUserCard = 0;
  
  var intvl = null;
  //touchend
  //mouseup
  var ev = 'touchend';
  
  $(document).ready(function(){         
       
    setColor(userColor);
    $('#usercard').css('background', colors[userColor]);
    // $('.card').bind(ev, stop);
    // intvl = setInterval(changeCard, 100);
        
  });
  
  function rotateIt(e){
    $('#br').addClass('tileHidden');
    $('#bl').addClass('tileHidden');
    $('#tr').addClass('tileHidden');
    return false;
  }
  
  function changeCard(){
    console.log('change');
      var color = getNextColor();
      totalCards++;
      if(color == userColor)
        totalUserCard++;
      setColor(color);
  }

  function getNextColor(origColor){
    var colorOptions = [ Math.floor(Math.random() * colors.length),
                    Math.floor(Math.random() * colors.length),
                    Math.floor(Math.random() * colors.length)
                  ];
    
    color = colorOptions[Math.floor(Math.random() * colorOptions.length)];
      
    return color;
  }

  function setColor(color) {
    $('#card').css('background', colors[color]);
  }

  function stop(e){
    clearInterval(intvl);
    alert('total: '+totalCards+', user chosen card: '+totalUserCard);
    alert('expected appearance: '+(1 / colors.length)+', actual appearance: '+ (totalUserCard / totalCards));
  }
  


////////// MENU ////////////
  var currPage = null;
  var maxTransTime = 2;

  function goToPage(pageId) {
    var elem = $('#menu');
    var transTime = maxTransTime;
    while(elem.attr('id') != pageId) {
      elem.css('-webkit-transition-duration', transTime+'s').addClass('tileHidden');
      transTime = transTime + 0.2;
      elem = elem.prev();
      currPage = elem;
    }
    // $('#back').css('opacity', 1);
  }
  
  function goHome() {
    if(!currPage) { return false; }
    
    // $('#back').css('opacity', 0);
    
    
    var elem = currPage;
    currPage = null;
    var transTime = maxTransTime;
    
    while(elem.attr('id') != 'menu') {
      elem = elem.next();
      elem.css('-webkit-transition-duration', transTime+'s').removeClass('tileHidden');
      transTime = transTime + 0.2;
    }
  }
  
  </script>
</head>
<body id="stage" class="theme" onload="onBodyLoad()">
  <div id="frame" class="content current">
      <div id="test" class="tile hinted">
        <h1 class="title">TEST</h1>
      </div>
      <div id="settings" class="tile hinted">
        <h1 class="title">SETTINGS</h1>
      </div>
      <div id="help" class="tile hinted">
        <h1 class="title">HELP</h1>
      </div>
      <div id="menu" class="tile hinted">
        <h1 class="title">MENU</h1>
        
        <a href="javascript:goToPage('test')" id="click">test</a> <br/>
        <a href="javascript:goToPage('settings')" id="click">settings</a> <br/>
        <a href="javascript:goToPage('help')" id="click">help</a> <br/>        
        <div id="back">
          <a href="javascript:goHome()" id="click">Home</a> <br/>        
        </div>
      </div>

  </div>  
</body>
</html>
