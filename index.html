<!DOCTYPE HTML>
<html>
<head>
  <!-- Change this if you want to allow scaling -->
  <meta name="viewport" content="width=default-width; user-scalable=no" />

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">

  <title>Odd Color</title>
  <link rel="stylesheet" href="master.css" type="text/css" />		
  <link rel="stylesheet" href="mindset.css" type="text/css" />		

  <!-- iPad/iPhone specific css below, add after your main css >
  <link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
  -->
  <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
  <script type="text/javascript" charset="utf-8" src="zepto.js"></script>
  <script type="text/javascript" charset="utf-8">


  // If you want to prevent dragging, uncomment this section
  /*
  function preventBehavior(e) 
  { 
  e.preventDefault(); 
  };
  document.addEventListener("touchmove", preventBehavior, false);
  */

  function onBodyLoad()
  {
    document.addEventListener("deviceready",onDeviceReady,false);
  }

  /* When this function is called, PhoneGap has been initialized and is ready to roll */
  function onDeviceReady()
  {
  }

  var score = 0;
  var current = -1;
  
  var colors = ['#6566ff', '#00ccff', '#33cd34', '#f8f701', '#fd6601', '#fe0002','#960298', '#960300'];
  var userColor = 0;
  var isPrefs = false;
  
  var totalCards = 0;
  var totalUserCard = 0;
  
  var intvl = null;
  //touchend
  //mouseup
  var ev = 'mouseup';
  
  $(document).ready(function(){        
    setColor(userColor);
    $('#usercard').css('background', colors[userColor]);
    $('.card').bind(ev, stop);
    intvl = setInterval(changeCard, 100);
    
  });
  
  function changeCard(){
    console.log('change');
      var color = getNextColor();
      totalCards++;
      if(color == userColor)
        totalUserCard++;
      setColor(color);
  }

  function getNextColor(origColor){
    var colorOptions = [ Math.floor(Math.random() * colors.length),
                    Math.floor(Math.random() * colors.length),
                    Math.floor(Math.random() * colors.length)
                  ];
    
    color = colorOptions[Math.floor(Math.random() * colorOptions.length)];
      
    return color;
  }

  function setColor(color) {
    $('#card').css('background', colors[color]);
  }

  function stop(e){
    clearInterval(intvl);
    alert('total: '+totalCards+', user chosen card: '+totalUserCard);
    alert('expected appearance: '+(1 / colors.length)+', actual appearance: '+ (totalUserCard / totalCards));
  }
  
  function togglePrefs(e){
    if($('#prefs').hasClass('showPrefs')) {
      $('#prefs').removeClass('showPrefs');
      $('#game').removeClass('showPrefs');      
    }
    else{
      $('#prefs').addClass('showPrefs');
      $('#game').addClass('showPrefs');
    }  
  }

  </script>
</head>
<body id="stage" class="theme" onload="onBodyLoad()">
  <div id="page1" class="content current">
    <div id="usercard" class="card"></div>
    <div id="card" class="card"></div>
  </div><!-- /page1  -->
  <div id="page2" class="content">
    <div id="prefs">
      prefs:
      - your color
      - change speed
      - users
      - leaderboard
      <div class="togglePrefs">+</div>
    </div>
  </div>  
</body>
</html>
